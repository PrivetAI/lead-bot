Обзор системы
Система представляет собой комплексное решение для автоматизации обработки лидов, состоящее из 4 основных компонентов:
Архитектура компонентов

n8n Workflow Engine (порт 5678)

Главный оркестратор системы
Обрабатывает webhook'и от amoCRM и Telegram
Выполняет AI-классификацию лидов через OpenAI
Интегрируется с Google Calendar
Координирует все процессы


Node.js API Server (порт 3000)

Интеграционный слой между компонентами
Управляет Telegram userbot'ом
Обрабатывает запросы от/к amoCRM
Предоставляет REST API для внешних систем


PostgreSQL Database (порт 5432)

Хранит данные лидов (leads)
Ведет историю переписок (conversations)
Сохраняет события календаря (calendar_events)
Логирует действия агента (agent_actions)
Redis Cache (порт 6379)
Кэширование состояний workflow  
Rate limiting для внешних API



Процесс работы системы
1. Поступление нового лида
amoCRM webhook → API Server (/amocrm/sync) → PostgreSQL → n8n webhook   // ?? подумать может вызывать постгрес из n8n а не с сервера 
2. AI-обработка лида
n8n → AI Classifier (OpenAI) → оценка качества лида → обновление в БД и amoCRM  // ?? когда начинаем писать лиду(всегда или когда агент определил его как релевантного)
3. Telegram взаимодействие
Входящее сообщение → Userbot → API Server → n8n → AI Sales Agent → ответ через Userbot // ?? т к сервер вызывает бд для получения инфы диалога 
4. Календарь и встречи
n8n AI Agent → Google Calendar API → создание события → сохранение в БД